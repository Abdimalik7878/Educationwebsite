<%- include("partials/nav_admin", { user }) %>

<div class="mb-3">
  <a class="btn btn-outline-secondary btn-sm" href="/admin/pages/<%= page.id %>/blocks">‚Üê Back to blocks</a>
</div>

<div class="card shadow-sm">
  <div class="card-body p-4">
    <h1 class="h5 fw-bold mb-1">Edit Block</h1>
    <div class="text-muted small">Type: <b><%= block.type %></b></div>

    <% if (error) { %>
      <div class="alert alert-danger mt-3"><%= error %></div>
    <% } %>

    <form method="POST" action="/admin/blocks/<%= block.id %>/edit" class="mt-3">

      <% if (block.type === "text") { %>
        <div class="mb-3">
          <label class="form-label">Heading</label>
          <input class="form-control" name="heading" value="<%= data.heading || "" %>">
        </div>
        <div class="mb-3">
          <label class="form-label">Body (supports new lines)</label>
          <textarea class="form-control" name="body" rows="7"><%= data.body || "" %></textarea>
        </div>

      <% } else if (block.type === "image") { %>
        <div class="mb-3">
          <label class="form-label">Heading</label>
          <input class="form-control" name="heading" value="<%= data.heading || "" %>">
        </div>
        <div class="mb-3">
          <label class="form-label">Image URL</label>
          <input class="form-control" name="imageUrl" value="<%= data.imageUrl || "" %>" placeholder="/public/uploads/yourfile.png">
          <div class="form-text">Upload from Media page, then paste the URL here.</div>
        </div>
        <div class="mb-3">
          <label class="form-label">Caption</label>
          <input class="form-control" name="caption" value="<%= data.caption || "" %>">
        </div>

      <% } else if (block.type === "video") { %>
        <div class="mb-3">
          <label class="form-label">Heading</label>
          <input class="form-control" name="heading" value="<%= data.heading || "" %>">
        </div>

        <div class="mb-3">
          <label class="form-label">Mode</label>
          <select class="form-select" name="mode">
            <option value="youtube" <%= (data.mode==="youtube")?"selected":"" %>>YouTube embed URL</option>
            <option value="mp4" <%= (data.mode==="mp4")?"selected":"" %>>MP4 URL (uploaded file)</option>
          </select>
        </div>

        <div class="mb-3">
          <label class="form-label">YouTube Embed URL</label>
          <input class="form-control" name="youtubeUrl" value="<%= data.youtubeUrl || "" %>" placeholder="https://www.youtube.com/embed/VIDEO_ID">
          <div class="form-text">Use embed format: <code>https://www.youtube.com/embed/VIDEO_ID</code></div>
        </div>

        <div class="mb-3">
          <label class="form-label">MP4 URL</label>
          <input class="form-control" name="mp4Url" value="<%= data.mp4Url || "" %>" placeholder="/public/uploads/video.mp4">
          <div class="form-text">Upload from Media page, then paste the URL here.</div>
        </div>

        <div class="mb-3">
          <label class="form-label">Caption</label>
          <input class="form-control" name="caption" value="<%= data.caption || "" %>">
        </div>

      <% } else if (block.type === "callout") { %>
        <div class="mb-3">
          <label class="form-label">Kind (label)</label>
          <input class="form-control" name="kind" value="<%= data.kind || "Key idea" %>" placeholder="Key idea / Fun fact / Tip">
        </div>
        <div class="mb-3">
          <label class="form-label">Body</label>
          <textarea class="form-control" name="body" rows="5"><%= data.body || "" %></textarea>
        </div>

      <% } else if (block.type === "quiz") { %>
        <div class="alert alert-info">
          Quiz is stored as JSON. Edit carefully. Example:
          <pre class="mb-0">{ "title":"Quick Quiz", "questions":[{"q":"...","options":["A","B"],"answer":0}] }</pre>
        </div>
        <div class="mb-3">
          <label class="form-label">Quiz JSON</label>
          <textarea class="form-control" name="quiz_json" rows="12"><%= JSON.stringify(data, null, 2) %></textarea>
        </div>
      <% } %>

      <div class="d-flex gap-2">
        <button class="btn btn-dark">Save</button>
        <a class="btn btn-outline-secondary" href="/admin/pages/<%= page.id %>/blocks">Cancel</a>
      </div>
    </form>
  </div>
</div>

<%- include("partials/footer_admin") %>
